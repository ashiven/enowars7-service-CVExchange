<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>

<%- include('../partials/profile-header') %>
<div class="layout-profile">

    <main><%- body %> </main>
    
    <side>
        <script>
            function filterImage() {
                const fileInput = document.uploadForm.profilePicture
            
                if (!(/\.(jpg|jpeg|png)$/i).test(fileInput.value)) {              
                    alert('Please select an image file')
                    fileInput.value = ''
                }
                if(fileInput.files[0].size > 5000000) {
                    alert('Please select a file under 5MB')
                    fileInput.value = ''
                }
            }
        </script>

        <label for="profilePicture">Profile Picture:</label><br>
        <%  if (user.profile_picture) { %>
            <img src="/<%= user.profile_picture %>" alt="Profile picture"><br>
            <% } 
            else { %>
            <p>No profile picture found.</p><br>
        <% } %>

        <form name="uploadForm" method="POST" enctype="multipart/form-data" action="/files/upload">
            <input type="file" name="profilePicture" onchange="filterImage()"><br><br>
            <button type="submit">Upload</button>
        </form>
        <form method="POST" action="/files/delete">
        <button type="submit">Delete</button>
        </form>
    </side>
    
</div>
<%- include('../partials/footer') %>


<% if(!req.cookies.jwtToken) { %>
<script>
const loginRequiredElements = document.querySelectorAll('.login-required')
console.log(document.cookie)
loginRequiredElements.forEach(element => {
  element.addEventListener('click', event => {
    if (!document.cookie.includes('jwtToken')) {
      event.preventDefault()
      window.location.href = '/user/login'
    }
  })
})
</script>
<% } %>


</body>
</html>