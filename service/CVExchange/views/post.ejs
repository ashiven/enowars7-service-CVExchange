<link rel="stylesheet" href="/css/main.css">

<h1><%= post.title %></h1>
<p><%= post.text %></p>
<p>Rating: <%= post.rating %></p>
<form method="POST" action="/votes/ratepost">
  <input type="hidden" name="postId" value="<%= post.id %>">
  <input type="hidden" name="rating" value=1>
  <input type="hidden" name="page" value="/posts/<%= post.id %>">
  <input type="submit" value="Upvote">
</form>
<form method="POST" action="/votes/ratepost">
  <input type="hidden" name="postId" value="<%= post.id %>">
  <input type="hidden" name="rating" value=-1>
  <input type="hidden" name="page" value="/posts/<%= post.id %>">
  <input type="submit" value="Downvote">
</form>

<h2>-Comment Section-</h2>
<form method="POST" action="/comments/new">
  <input type="hidden" name="postId" value="<%= post.id %>">
  <label for="comment">Add a Comment:</label><br>
  <textarea id="comment" name="comment" rows="4" cols="50"></textarea><br>
  <input type="submit" value="Submit">
</form>

<div>
<% for (let comment of comments) { %>
<div class="comment">
    <div class="voting-section">
        <div class="upvote-comment <%= ratings.some(r => r.comment_id === comment.id && r.rating === 1) ? 'on' : '' %>" data-commentid="<%= comment.id %>">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-big-up-filled" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M10.586 3l-6.586 6.586a2 2 0 0 0 -.434 2.18l.068 .145a2 2 0 0 0 1.78 1.089h2.586v7a2 2 0 0 0 2 2h4l.15 -.005a2 2 0 0 0 1.85 -1.995l-.001 -7h2.587a2 2 0 0 0 1.414 -3.414l-6.586 -6.586a2 2 0 0 0 -2.828 0z" stroke-width="0" fill="currentColor" />
            </svg>
        </div>
        <div class="downvote-comment <%= ratings.some(r => r.comment_id === comment.id && r.rating === -1) ? 'on' : '' %>" data-commentid="<%= comment.id %>">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-arrow-big-down-filled" width="28" height="28" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <path d="M10 2l-.15 .005a2 2 0 0 0 -1.85 1.995v6.999l-2.586 .001a2 2 0 0 0 -1.414 3.414l6.586 6.586a2 2 0 0 0 2.828 0l6.586 -6.586a2 2 0 0 0 .434 -2.18l-.068 -.145a2 2 0 0 0 -1.78 -1.089l-2.586 -.001v-6.999a2 2 0 0 0 -2 -2h-4z" stroke-width="0" fill="currentColor" />
            </svg>
        </div>
    </div>
    <div class="comment-body">
        <div class="comment-title">
            <a href="/user/profile/<%= comment.creator_id %>" class=""><%= comment.creator_name %></a>&nbsp;
            <span class="comment-score"><%= comment.rating %> points</span>&nbsp;
            <time datetime="<%= comment.datetime %>" class="timestamp"><%= comment.datetime.toString().slice(0, -36) %></time>
        </div>
        <div class="comment-text">
            <%= comment.text %>
        </div>
        <ul class="comment-buttons">
            <li class="save-button"><a class="login-required" href="/comments/save/<%= comment.id %>">save</a></li>
            <li class="hide-button"><a class="login-required" href="/comments/hide/<%= comment.id %>">hide</a></li>
            <% if(parseInt(req.userId) === parseInt(comment.creator_id)) { %>
            <li class="edit-button"><a class="login-required" href="/comments/delete/<%= comment.id %>">delete</a></li>
            <li class="delete-button"><a class="login-required" href="/comments/edit/<%= comment.id %>">edit</a></li>
            <% } %>
        </ul>
    </div>
</div>
<% } %>
</div>